<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vidéo avec image d'attente</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    .servo.selected {
      border: 2px solid #0d6efd;
    }
    .etapes.active-step {
      background-color: #0d6efd;
      color: white;
    }
    .partie {
      width: 24px;
      height: 24px;
    }
  </style>
</head>
<body>
  <div class="container mt-4">

    <div class="row mb-3">
      <div class="col-4">
        <div id="cards-container" class="d-flex flex-wrap gap-2">
          <!-- Les cartes seront injectées ici -->
        </div>
      </div>
      <div class="col-8">
        <div class="ratio ratio-16x9 position-relative">
          <video id="video-player" controls style="width: 100%; height: 100%;">
            <source id="video-source" src="" type="video/mp4" />
            Votre navigateur ne supporte pas la balise vidéo.
          </video>
          <img
            id="video-placeholder"
            src="attente.png"
            alt="Attente"
            style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: contain; display: none;"
          />
        </div>
        <div id="etapes-container" class="list-group mt-3"></div>
      </div>
    </div>

  </div>

  <script>
    const data = {
      "range1": [
        {
          video: "video1.mp4",
          steps: [
            { label: "Début", time: 0 },
            { label: "Milieu", time: 10 },
            { label: "Fin", time: 20 },
          ],
        },
        {
          video: "", // Pas de vidéo, on doit afficher l'image attente.png
          steps: [
            { label: "Etape 1", time: 0 },
            { label: "Etape 2", time: 5 },
          ],
        },
        {
          video: "attente.png", // Même comportement : on affiche l'image attente
          steps: [],
        },
      ],
    };

    const range = "range1";

    const cardsContainer = document.getElementById("cards-container");
    const videoPlayer = document.getElementById("video-player");
    const videoSource = document.getElementById("video-source");
    const etapesContainer = document.getElementById("etapes-container");
    const videoPlaceholder = document.getElementById("video-placeholder");

    // Création des cartes pour chaque item
    function createCards() {
      data[range].forEach((item, index) => {
        const card = document.createElement("div");
        card.className = "servo p-3 border rounded";
        card.style.cursor = "pointer";
        card.setAttribute("data-index", index);
        card.textContent = item.video ? item.video : "Image attente";
        cardsContainer.appendChild(card);
      });
    }

    // Gestion des clics sur les cartes
    function attachCardEvents() {
      const cards = document.querySelectorAll(".servo");
      cards.forEach((card) => {
        card.addEventListener("click", () => {
          // Désélectionner toutes les cartes
          cards.forEach((c) => c.classList.remove("selected"));
          card.classList.add("selected");

          const index = card.getAttribute("data-index");
          const item = data[range][index];

          if (!item.video || item.video.trim() === "" || item.video.trim() === "attente.png") {
            // Pas de vidéo, on cache la vidéo et on affiche l'image attente
            videoPlayer.style.display = "none";
            videoPlaceholder.style.display = "block";
          } else {
            // On affiche la vidéo, on cache l'image attente
            videoPlayer.style.display = "block";
            videoPlaceholder.style.display = "none";

            videoSource.src = item.video;
            videoPlayer.load();
            videoPlayer.play();
          }

          // Affichage des étapes
          etapesContainer.innerHTML = "";
          item.steps.forEach((step, idx) => {
            const stepElement = document.createElement("div");
            stepElement.className = "list-group-item etapes d-flex justify-content-between align-items-center py-2 mb-2";
            stepElement.innerHTML = `
              <span><img class="partie" src="HMTL_JS/icons/${idx + 1}.png" alt="Icon ${idx + 1}"></span>
              <span class="badge bg-secondary">${step.label}</span>
            `;
            stepElement.addEventListener("click", () => {
              document.querySelectorAll(".etapes").forEach((el) => el.classList.remove("active-step"));
              stepElement.classList.add("active-step");
              videoPlayer.currentTime = step.time;
              videoPlayer.play();
            });
            etapesContainer.appendChild(stepElement);
          });
        });
      });
    }

    // Initialisation
    createCards();
    attachCardEvents();

    // Optionnel : sélectionner la première carte par défaut
    document.querySelector(".servo").click();
  </script>
</body>
</html>
